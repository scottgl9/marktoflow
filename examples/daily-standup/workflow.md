---
workflow:
  id: daily-standup-summary
  name: 'Daily Standup Summary'
  version: '2.0.0'
  description: 'Aggregates team updates and generates a daily standup summary using native Slack and Jira integrations'
  author: 'marktoflow'
  tags:
    - team
    - communication
    - scheduling

tools:
  slack:
    sdk: '@slack/web-api'
    auth:
      token: '${SLACK_BOT_TOKEN}'

  jira:
    sdk: 'jira.js'
    auth:
      host: '${JIRA_HOST}'
      email: '${JIRA_EMAIL}'
      apiToken: '${JIRA_API_TOKEN}'

  claude:
    sdk: 'claude-code'
    auth:
      api_key: '${ANTHROPIC_API_KEY}'

triggers:
  - type: schedule
    cron: '0 9 * * 1-5' # 9 AM on weekdays
    timezone: 'America/New_York'

inputs:
  team_channel:
    type: string
    default: '#engineering'
    description: 'Slack channel for the team'
  jira_project:
    type: string
    required: true
    description: 'JIRA project key'
  lookback_hours:
    type: number
    default: 24
    description: 'Hours to look back for updates'

outputs:
  summary:
    type: string
    description: 'Generated standup summary'
  active_issues:
    type: number
    description: 'Number of active issues'
---

# Daily Standup Summary

This workflow runs every weekday morning to collect team updates from Jira and Slack, then generates an AI-powered standup summary that's posted to Slack.

## Step 1: Get Recent JIRA Updates

Fetch issues updated in the last 24 hours.

```yaml
action: jira.issueSearch.searchForIssuesUsingJql
inputs:
  jql: 'project = {{ inputs.jira_project }} AND updated >= -{{ inputs.lookback_hours }}h ORDER BY updated DESC'
  fields:
    - summary
    - status
    - assignee
    - updated
  maxResults: 50
output_variable: recent_issues
```

## Step 2: Get In-Progress Work

Get all issues currently in progress.

```yaml
action: jira.issueSearch.searchForIssuesUsingJql
inputs:
  jql: "project = {{ inputs.jira_project }} AND status = 'In Progress' ORDER BY assignee"
  fields:
    - summary
    - status
    - assignee
    - priority
  maxResults: 50
output_variable: in_progress
```

## Step 3: Get Blocked Issues

Find any blocked or impediment issues.

```yaml
action: jira.issueSearch.searchForIssuesUsingJql
inputs:
  jql: "project = {{ inputs.jira_project }} AND (status = 'Blocked' OR labels = 'blocked')"
  fields:
    - summary
    - assignee
    - comment
  maxResults: 20
output_variable: blocked_issues
```

## Step 4: Get Recent Slack Activity

Fetch recent messages from the team channel.

```yaml
action: slack.conversations.history
inputs:
  channel: '{{ inputs.team_channel }}'
  oldest: '{{ (Date.now() / 1000) - (inputs.lookback_hours * 3600) }}'
  limit: 50
output_variable: slack_messages
```

## Step 5: Generate Summary

Use Claude to generate a coherent standup summary from the collected data.

```yaml
action: claude.chat.completions
inputs:
  model: 'claude-3-5-sonnet-20241022'
  messages:
    - role: 'user'
      content: |
        Generate a daily standup summary based on the following team data:

        **Recent Jira Updates (last {{ inputs.lookback_hours }}h):**
        {% for issue in recent_issues.issues %}
        - [{{ issue.key }}] {{ issue.fields.summary }} - {{ issue.fields.status.name }} ({{ issue.fields.assignee.displayName }})
        {% endfor %}

        **In Progress:**
        {% for issue in in_progress.issues %}
        - [{{ issue.key }}] {{ issue.fields.summary }} - {{ issue.fields.assignee.displayName }}
        {% endfor %}

        **Blocked Issues:**
        {% for issue in blocked_issues.issues %}
        - [{{ issue.key }}] {{ issue.fields.summary }} - {{ issue.fields.assignee.displayName }}
        {% endfor %}

        **Recent Slack Activity:**
        {{ slack_messages.messages.length }} messages in {{ inputs.team_channel }}

        Create a standup summary with these sections:

        1. **âœ… Completed Yesterday** - Issues moved to Done
        2. **ðŸš€ In Progress Today** - Active work items with assignees
        3. **ðŸš§ Blockers & Impediments** - Issues that need attention
        4. **ðŸ’¬ Team Highlights** - Notable updates or discussions

        Format in Slack markdown. Keep it concise and actionable. Use bullet points.
        Mention team members with @username where appropriate.
output_variable: summary_content
```

## Step 6: Post to Slack

Post the generated summary to the team channel with formatted blocks.

```yaml
action: slack.chat.postMessage
inputs:
  channel: '{{ inputs.team_channel }}'
  text: 'Daily Standup Summary'
  blocks:
    - type: header
      text:
        type: plain_text
        text: 'ðŸŒ… Daily Standup Summary'
    - type: section
      text:
        type: mrkdwn
        text: '{{ summary_content }}'
    - type: divider
    - type: context
      elements:
        - type: mrkdwn
          text: '_Generated by marktoflow v2.0 â€¢ {{ new Date().toISOString() }}_'
output_variable: post_result
```

## Step 7: Set Outputs

```yaml
action: workflow.set_outputs
inputs:
  summary: '{{ summary_content }}'
  active_issues: '{{ in_progress.issues.length }}'
```
